<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use Cases for Metabolomics Data Annotation Using MetaboAnnotation • MetaboAnnotationTutorials</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use Cases for Metabolomics Data Annotation Using MetaboAnnotation">
<meta property="og:description" content="MetaboAnnotationTutorials">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MetaboAnnotationTutorials</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/annotation-use-cases.html">Use Cases for Metabolomics Data Annotation Using MetaboAnnotation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jorainer/MetaboAnnotationTutorials/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use Cases for Metabolomics Data Annotation Using MetaboAnnotation</h1>
                        <h4 data-toc-skip class="author">Johannes Rainer, Andrea Vicini, Liesa Salzer, Jan Stanstrup, Josep M Badia,<br>
Steffen Neumann, Michael Stravs, Vinicius Verri Hernandes, Laurent Gatto, Sebastian Gibb<br>
and Michael Witting</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jorainer/MetaboAnnotationTutorials/blob/HEAD/vignettes/annotation-use-cases.Rmd" class="external-link"><code>vignettes/annotation-use-cases.Rmd</code></a></small>
      <div class="hidden name"><code>annotation-use-cases.Rmd</code></div>

    </div>

    
    
<p>This documents provides use cases describing the annotation of untarget metabolomics and small compound datasets using functionality from the <em><a href="https://bioconductor.org/packages/3.14/MetaboAnnotation" class="external-link">MetaboAnnotation</a></em>, <em><a href="https://bioconductor.org/packages/3.14/MetaboCoreUtils" class="external-link">MetaboCoreUtils</a></em> and <em><a href="https://bioconductor.org/packages/3.14/CompoundDb" class="external-link">CompoundDb</a></em> packages. All data used in this document is available within the <a href="https://github.com/jorainer/MetaboAnnotationTutorials" class="external-link">github repository</a> <a href="https://github.com/jorainer/MetaboAnnotationTutorials" class="external-link uri">https://github.com/jorainer/MetaboAnnotationTutorials</a>. Additional use cases and examples can be found in the packages’ vignettes and workshops/tutorials. See section <em>Package repositories and additional tutorials</em> for links to the package repositories and tutorials.</p>
<div class="section level2">
<h2 id="installation-instructions">Installation instructions<a class="anchor" aria-label="anchor" href="#installation-instructions"></a>
</h2>
<p>The R packages as well as the example files used in this document can be installed with the R code below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span>
<span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"jorainer/MetaboAnnotationTutorials"</span><span class="op">)</span></code></pre></div>
<p>The source code for this document along with the test data can be downloaded from the github repository <a href="https://github.com/jorainer/MetaboAnnotationTutorials" class="external-link uri">https://github.com/jorainer/MetaboAnnotationTutorials</a> with the command (or alternatively downloading the zip archive directly from the github page).</p>
<pre><code>git clone https://github.com/jorainer/MetaboAnnotationTutorials</code></pre>
</div>
<div class="section level2">
<h2 id="ms1-annotation">
<span class="math inline">\(MS^1\)</span> annotation<a class="anchor" aria-label="anchor" href="#ms1-annotation"></a>
</h2>
<p>In this example we annotate chromatographic peaks identified in a test sample provided within this repository first based only on their <em>m/z</em> values and then using their <em>m/z</em> and retention times against previously determined values for a set of pure standards. The test data represents LC-MS/MS measurements of a set of metabolite standards. In brief, aliquots for pure standards of 15 metabolites were solved in water and injected into a LC-MS system. Details are provided in the Material and Methods section in the main text.</p>
<p>Below we load the data which is distributed within the <code>MetaboAnnotationTutorials</code> package and perform the chromatographic peak detection using the <em><a href="https://bioconductor.org/packages/3.14/xcms" class="external-link">xcms</a></em> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span>

<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mzML"</span>, <span class="st">"HighIS_Mix07_CE20_POS.mzML"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>

<span class="va">std_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/readMSData.html" class="external-link">readMSData</a></span><span class="op">(</span><span class="va">fl</span>, mode <span class="op">=</span> <span class="st">"onDisk"</span><span class="op">)</span></code></pre></div>
<p>We next perform the chromatographic peak detection using the <em>centWave</em> algorithm followed by a <em>peak refinement</em> to reduce the number of peak detection artifacts, such as split-peaks or overlapping peaks (see the <em>LC-MS/MS data analysis with xcms</em> vignette from the <code>xcms</code> package for details on the chromatographic peak detection settings).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Peak detection</span>
<span class="va">cwp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/findChromPeaks-centWave.html" class="external-link">CentWaveParam</a></span><span class="op">(</span>snthresh <span class="op">=</span> <span class="fl">10</span>, prefilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4000</span><span class="op">)</span>, ppm <span class="op">=</span> <span class="fl">40</span>,
                     peakwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span>, integrate <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">std_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/chromatographic-peak-detection.html" class="external-link">findChromPeaks</a></span><span class="op">(</span><span class="va">std_data</span>, param <span class="op">=</span> <span class="va">cwp</span><span class="op">)</span>
<span class="co">#' Peak refinement</span>
<span class="va">std_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks-clean.html" class="external-link">refineChromPeaks</a></span><span class="op">(</span>
    <span class="va">std_data</span>, <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/refineChromPeaks-merge.html" class="external-link">MergeNeighboringPeaksParam</a></span><span class="op">(</span>expandRt <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In total 175 chromatographic peaks have been identified. This is even more than would be expected since the sample represents a mixture of 15 pure standards solved in water. Below we display the first 6 of the detected chromatographic peaks.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">std_data</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##              mz     mzmin     mzmax     rt  rtmin  rtmax       into       intb</span>
<span class="co">## CP001 355.28240 355.28193 355.28369 30.495 24.575 37.641  83909.909  78939.997</span>
<span class="co">## CP002 358.98005 358.97954 358.98037 10.390 10.065 11.356   7002.894   6897.381</span>
<span class="co">## CP003 413.26607 413.26573 413.26704 32.892 25.729 37.641 102217.289 100770.550</span>
<span class="co">## CP004 301.14091 301.13962 301.14279 25.729 24.575 40.013  47095.520  44283.920</span>
<span class="co">## CP005  80.02494  80.02419  80.02543 40.013 35.261 56.554  53223.003  53005.070</span>
<span class="co">## CP006  63.99953  63.99950  63.99958 42.371 35.261 61.268 156775.850 156184.543</span>
<span class="co">##            maxo  sn sample</span>
<span class="co">## CP001 10329.126  25      1</span>
<span class="co">## CP002  5138.685  32      1</span>
<span class="co">## CP003 22355.266  90      1</span>
<span class="co">## CP004  7085.818  40      1</span>
<span class="co">## CP005  6082.308 181      1</span>
<span class="co">## CP006 17705.469 242      1</span></code></pre>
<p>We next annotate these chromatographic peaks using only their <em>m/z</em> values. As a reference we load a <code>CompDb</code> database containing all compounds from the Human Metabolom Database <span class="citation">(Wishart et al. 2018)</span> version 5.0 which is also provided as a data release on the <code>MetaboAnnotationTutorials</code> <a href="https://github.com/jorainer/MetaboAnnotationTutorials" class="external-link">github repository</a>. The database was build from HMDB 5.0 (2021-11-02) using the <em><a href="https://bioconductor.org/packages/3.14/CompoundDb" class="external-link">CompoundDb</a></em> package (see the <a href="https://RforMassSpectrometry.github.io/CompoundDb" class="external-link">package documentation</a> for more information).</p>
<p>Below we download the database from github to a temporary folder.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Download the CompDb database using curl</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeroen/curl" class="external-link">curl</a></span><span class="op">)</span>
<span class="va">dbname</span> <span class="op">&lt;-</span> <span class="st">"CompDb.Hsapiens.HMDB.5.0.sqlite"</span>
<span class="va">db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">dbname</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html" class="external-link">curl_download</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://github.com/jorainer/MetaboAnnotationTutorials/"</span>,
           <span class="st">"releases/download/2021-11-02/"</span>, <span class="va">dbname</span><span class="op">)</span>,
    destfile <span class="op">=</span> <span class="va">db_file</span><span class="op">)</span></code></pre></div>
<p>We next load the database using the <code>CompoundDb</code> package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/CompoundDb" class="external-link">CompoundDb</a></span><span class="op">)</span>
<span class="co">#' Load a CompDb database with compound annotation from HMDB</span>
<span class="va">cdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CompoundDb/man/CompDb.html" class="external-link">CompDb</a></span><span class="op">(</span><span class="va">db_file</span><span class="op">)</span>
<span class="va">cdb</span></code></pre></div>
<pre><code><span class="co">## class: CompDb </span>
<span class="co">##  data source: HMDB </span>
<span class="co">##  version: 5.0 </span>
<span class="co">##  organism: Hsapiens </span>
<span class="co">##  compound count: 217776 </span>
<span class="co">##  MS/MS spectra count: 64920</span></code></pre>
<p><strong>Note</strong>: while we are here annotating chromatographic peaks from an <code>xcms</code> result object, it would also be possible to annotate LC-MS features using the same approach by simply exchanging the <code>chromPeaks</code> call with <code>featureDefinitions</code>. In addition, the annotation could also be performed on a <code>SummarizedExperiment</code> representing the preprocessing results which can be generated from an <code>xcms</code> result object using the <code>quantify</code> method.</p>
<div class="section level3">
<h3 id="ms1mz">Annotation using <em>m/z</em> values<a class="anchor" aria-label="anchor" href="#ms1mz"></a>
</h3>
<p>We next extract all peaks from the <code>xcms</code> result object and annotate them using the <code>matchMz</code> function against all compounds from HMDB (the compound annotations can be extracted from the <code>CompDb</code> database with the <code>compounds</code> function). The reference database does not provide <em>m/z</em> values but only exact masses for each compound. Thus, in order to annotate our chromatographic peaks’ <em>m/z</em> values, <em>m/z</em> values for expected ions of the compounds need to be calculated first. With <code>Mass2MzParam</code> we can configure the parameters for the annotation. Parameter <code>adducts</code> allows to specify the adducts (ions) we expect to see mostly in the data set. For our example we assume to see mostly <code>[M+H]+</code> and <code>[M+Na]+</code> positive ions. With parameters <code>tolerance</code> and <code>ppm</code> we can finally define also the absolute and/or <em>m/z</em> relative acceptable difference, respectively, for <em>m/z</em> values to be considered matching.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MetaboAnnotation" class="external-link">MetaboAnnotation</a></span><span class="op">)</span>

<span class="co">#' Get the chromatographic peaks and add a column with the peak_id</span>
<span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>peak_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">std_data</span><span class="op">)</span><span class="op">)</span>,
                  <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/XCMSnExp-class.html" class="external-link">chromPeaks</a></span><span class="op">(</span><span class="va">std_data</span><span class="op">)</span><span class="op">)</span>

<span class="co">#' Set parameters for the m/z-based annotation</span>
<span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">Mass2MzParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,
                      tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co">#' Perform the matching</span>
<span class="va">pks_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span>
    <span class="va">pks</span>,
    <span class="fu">compounds</span><span class="op">(</span><span class="va">cdb</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"exactmass"</span>, <span class="st">"formula"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span>,
    param <span class="op">=</span> <span class="va">param</span><span class="op">)</span>

<span class="va">pks_match</span></code></pre></div>
<pre><code><span class="co">## Object of class Matched </span>
<span class="co">## Total number of matches: 697 </span>
<span class="co">## Number of query objects: 175 (112 matched)</span>
<span class="co">## Number of target objects: 217776 (393 matched)</span></code></pre>
<p>The result object handles the potential many-to-many matching between chromatographic peaks (<em>query</em>) and reference (<em>target</em>) and contains all information from both the query and the target object along with the <em>score</em> for the match (in this case the difference between the <em>m/z</em> values). Below we list all available information in the result object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "peak_id"            "mz"                 "mzmin"             </span>
<span class="co">##  [4] "mzmax"              "rt"                 "rtmin"             </span>
<span class="co">##  [7] "rtmax"              "into"               "intb"              </span>
<span class="co">## [10] "maxo"               "sn"                 "sample"            </span>
<span class="co">## [13] "target_compound_id" "target_name"        "target_formula"    </span>
<span class="co">## [16] "target_exactmass"   "adduct"             "score"</span></code></pre>
<p>The n:m mapping is represented in the <code>matches</code> data frame. It maps each annotated query element to all matching target elements. Below we list the first 6 rows from that table. Column <code>"score"</code> provides the difference between the query and target <em>m/z</em> values (in Da).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matches</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   query_idx target_idx adduct       score</span>
<span class="co">## 1         1       6977 [M+H]+ 0.001888540</span>
<span class="co">## 2         1       7006 [M+H]+ 0.001888540</span>
<span class="co">## 3         1     158233 [M+H]+ 0.001888540</span>
<span class="co">## 4         1     160274 [M+H]+ 0.001888540</span>
<span class="co">## 5         1     170679 [M+H]+ 0.001888540</span>
<span class="co">## 6         2     164617 [M+H]+ 0.003242238</span></code></pre>
<p>For users it’s however more convenient to extract annotation information with the <code>matchedData</code> function, that will return a data frame with all annotations. If query elements are annotated to more than one target element they will be listed in as many rows as there are matches. Not matching query elements are represented with a single row in the result table, containing <code>NA</code> for all annotations. Below we extract all annotations, restricting to some of the annotation columns.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matchedData</a></span><span class="op">(</span><span class="va">pks_match</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak_id"</span>, <span class="st">"target_name"</span>,
                         <span class="st">"target_formula"</span>, <span class="st">"adduct"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 760 rows and 4 columns</span>
<span class="co">##               peak_id            target_name target_formula      adduct</span>
<span class="co">##           &lt;character&gt;            &lt;character&gt;    &lt;character&gt; &lt;character&gt;</span>
<span class="co">## CP001           CP001 MG(0:0/18:2(9Z,12Z)/..       C21H38O4      [M+H]+</span>
<span class="co">## CP001.1         CP001 MG(18:2(9Z,12Z)/0:0/..       C21H38O4      [M+H]+</span>
<span class="co">## CP001.2         CP001 Glyceryl monolinoleate       C21H38O4      [M+H]+</span>
<span class="co">## CP001.3         CP001   2-Linoleoyl Glycerol       C21H38O4      [M+H]+</span>
<span class="co">## CP001.4         CP001             RIOPROSTIL       C21H38O4      [M+H]+</span>
<span class="co">## ...               ...                    ...            ...         ...</span>
<span class="co">## CPM186.9       CPM186 4-Ethoxy-p-menth-1-ene        C12H22O     [M+Na]+</span>
<span class="co">## CPM186.10      CPM186 cis-3-Ethoxy-p-menth..        C12H22O     [M+Na]+</span>
<span class="co">## CPM187         CPM187                     NA             NA          NA</span>
<span class="co">## CPM188         CPM188                     NA             NA          NA</span>
<span class="co">## CPM189         CPM189                     NA             NA          NA</span></code></pre>
<p>As we can see, the number of rows of this data frame is much larger than the number of chromatographic peaks. Most peaks are in fact annotated to several possible compounds based on their <em>m/z</em>. The average number of compounds to which a chromatographic peak in this data is annotated is calculated below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matches</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> |&gt;
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span> |&gt;
<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6.223214</span></code></pre>
<p>Annotations in the result object are organized by query, annotations for individual query elements can thus be accessed very easily. Below we list all annotations for the first chromatographic peak.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matchedData</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak_id"</span>, <span class="st">"target_name"</span>,
                            <span class="st">"target_formula"</span>, <span class="st">"adduct"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## DataFrame with 5 rows and 4 columns</span>
<span class="co">##             peak_id            target_name target_formula      adduct</span>
<span class="co">##         &lt;character&gt;            &lt;character&gt;    &lt;character&gt; &lt;character&gt;</span>
<span class="co">## CP001         CP001 MG(0:0/18:2(9Z,12Z)/..       C21H38O4      [M+H]+</span>
<span class="co">## CP001.1       CP001 MG(18:2(9Z,12Z)/0:0/..       C21H38O4      [M+H]+</span>
<span class="co">## CP001.2       CP001 Glyceryl monolinoleate       C21H38O4      [M+H]+</span>
<span class="co">## CP001.3       CP001   2-Linoleoyl Glycerol       C21H38O4      [M+H]+</span>
<span class="co">## CP001.4       CP001             RIOPROSTIL       C21H38O4      [M+H]+</span></code></pre>
<p>All compounds have thus the exact same chemical formula and hence, using only the <em>m/z</em> value, we can not discriminate between them or determine which would be the correct annotation. Considering also the retention times would allow a better annotation and increase its confidence.</p>
</div>
<div class="section level3">
<h3 id="annotation-using-reference-mz-and-retention-times">Annotation using reference <em>m/z</em> and retention times<a class="anchor" aria-label="anchor" href="#annotation-using-reference-mz-and-retention-times"></a>
</h3>
<p>For LC-MS experiments compounds are first chromatographically separated based on some property of the compound (other than their mass). Thus, also the retention times contain information that can improve the annotation. In this section we use information from a previous experiment in which pure standards were measured with the same LC-MS setup used to generate the present test data and in which the retention time as well as the ion (adduct) and its <em>m/z</em> value were determined. These reference values were thus empirically determined on the same instruments with the same setup and should thus help to get higher confidence annotations.</p>
<p>Below we load the reference retention time and <em>m/z</em> data for some of the measured standards.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"txt"</span>, <span class="st">"std_ions.txt"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>
<span class="va">std_ions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fl</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="va">std_ions</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   compound_id ion_adduct ion_rt   ion_mz</span>
<span class="co">## 1 HMDB0001539     [M+H]+    176 203.1503</span>
<span class="co">## 2 HMDB0000905     [M+H]+    208 332.0754</span>
<span class="co">## 3 HMDB0001847     [M+H]+     35 195.0877</span>
<span class="co">## 4 HMDB0001413     [M+H]+    217 490.1224</span>
<span class="co">## 5 HMDB0000562     [M+H]+     87 114.0662</span>
<span class="co">## 6 HMDB0000086     [M+H]+    189 258.1101</span></code></pre>
<p>We can now annotate the chromatographic peaks using this reference data. We configure the matching using the <code>MzRtParam</code>, which allows to annotate query elements based on <em>m/z</em> and retention times. With <code>ppm</code> we define again the <em>m/z</em>-relative acceptable difference of the <em>m/z</em> values and with <code>toleranceRt</code> the absolute acceptable difference in measured retention times. The parameters <code>mzColname</code> and <code>rtColname</code> allow us to define the names of the columns in the query and target objects containing the <em>m/z</em> values and retention time values for the matching. Settings for <code>ppm</code> and <code>toleranceRt</code> should be adapted to the experimental setup, retention time difference could e.g. be larger for HILIC-based chromatographic separation. Below we use a difference of 7 seconds (since retention times in <code>std_ions</code> and in the <code>xcms</code> result are reported in seconds).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">MzRtParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">10</span>, toleranceRt <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="va">pks_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span><span class="va">pks</span>, <span class="va">std_ions</span>, param <span class="op">=</span> <span class="va">param</span>,
                     mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"ion_mz"</span><span class="op">)</span>,
                     rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"ion_rt"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pks_match</span></code></pre></div>
<pre><code><span class="co">## Object of class Matched </span>
<span class="co">## Total number of matches: 9 </span>
<span class="co">## Number of query objects: 175 (9 matched)</span>
<span class="co">## Number of target objects: 19 (9 matched)</span></code></pre>
<p>In addition to supplying the reference (target) data as a <code>data.frame</code> we could also directly use an <code>IonDb</code>. This type of annotation object extends the above used <code>CompDb</code> database providing in addition to general compound annotations also information on measured ions including their retention times and <em>m/z</em> values. It is thus designed to contain reference annotation databases for specific LC-MS setups and MS instrumentation used in a lab. Below we create such an <code>IonDb</code> database (which will be saved in the present example to a temporary file) from the HMDB <code>CompDb</code> database and add our ion annotations to it.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Create an IonDb filling it with data from cdb.</span>
<span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CompoundDb/man/IonDb.html" class="external-link">IonDb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">cdb</span><span class="op">)</span>

<span class="co">#' Insert measured m/z and retention times for ions</span>
<span class="va">idb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CompoundDb/man/IonDb.html" class="external-link">insertIon</a></span><span class="op">(</span><span class="va">idb</span>, <span class="va">std_ions</span><span class="op">)</span>
<span class="va">idb</span></code></pre></div>
<pre><code><span class="co">## class: IonDb </span>
<span class="co">##  data source: HMDB </span>
<span class="co">##  version: 5.0 </span>
<span class="co">##  organism: Hsapiens </span>
<span class="co">##  compound count: 217776 </span>
<span class="co">##  MS/MS spectra count: 64920 </span>
<span class="co">##  ion count: 19</span></code></pre>
<p>The advantage of such an annotation database over individual (text) file-based annotation approaches is obvious: along with the annotation data also metadata can be saved and the database can be versioned, which is crucial for reproducible workflows. Also, the database’s SQLite file is portable and can be distributed and used on different computers. In addition, it would also be possible to use a MySQL-based database system which would enable centralized annotation resources in a laboratory. More information on the creation and usage of annotation resources with the <code>CompoundDb</code> package is provided in its package vignettes which are also available <a href="https://RforMassSpectrometry.github.io/CompoundDb/" class="external-link">here</a>.</p>
<p>We can now annotate our peaks against that database using the same call as above, but providing the <code>idb</code> as <code>target</code> parameter.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pks_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span>
    <span class="va">pks</span>, <span class="fu"><a href="https://rdrr.io/pkg/CompoundDb/man/IonDb.html" class="external-link">ions</a></span><span class="op">(</span><span class="va">idb</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"ion_adduct"</span>, <span class="st">"ion_mz"</span>, <span class="st">"ion_rt"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span>,
    param <span class="op">=</span> <span class="va">param</span>, mzColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"ion_mz"</span><span class="op">)</span>,
    rtColname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"ion_rt"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pks_match</span></code></pre></div>
<pre><code><span class="co">## Object of class Matched </span>
<span class="co">## Total number of matches: 9 </span>
<span class="co">## Number of query objects: 175 (9 matched)</span>
<span class="co">## Number of target objects: 19 (9 matched)</span></code></pre>
<p>In total 9 chromatographic peaks were annotated to an ion of one of the standards. We can identify the chromatographic peaks with available annotation using the <code>whichQuery</code> function, that returns their index in the query. Below we thus also subset the matched results to only those chromatographics peaks with an annotation.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">whichQuery</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1]  61  68  74  86  88 131 142 148 162</span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pks_match</span> <span class="op">&lt;-</span> <span class="va">pks_match</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">whichQuery</a></span><span class="op">(</span><span class="va">pks_match</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We next build a result table for the successfully annotated chromatographic peaks.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matchedData</a></span><span class="op">(</span><span class="va">pks_match</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak_id"</span>, <span class="st">"target_name"</span>, <span class="st">"score"</span>, <span class="st">"score_rt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.tables <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center"> </th>
<th align="center">peak_id</th>
<th align="center">target_name</th>
<th align="center">score</th>
<th align="center">score_rt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>CP067</strong></td>
<td align="center">CP067</td>
<td align="center">Caffeine</td>
<td align="center">0.0006847</td>
<td align="center">0.261</td>
</tr>
<tr class="even">
<td align="center"><strong>CP074</strong></td>
<td align="center">CP074</td>
<td align="center">Creatinine</td>
<td align="center">0.0001926</td>
<td align="center">0.238</td>
</tr>
<tr class="odd">
<td align="center"><strong>CP080</strong></td>
<td align="center">CP080</td>
<td align="center">Sphingosine</td>
<td align="center">0.0003391</td>
<td align="center">3.013</td>
</tr>
<tr class="even">
<td align="center"><strong>CP094</strong></td>
<td align="center">CP094</td>
<td align="center">L-Methionine</td>
<td align="center">0.0001487</td>
<td align="center">6.839</td>
</tr>
<tr class="odd">
<td align="center"><strong>CP096</strong></td>
<td align="center">CP096</td>
<td align="center">1-Methyluric acid</td>
<td align="center">0.0002982</td>
<td align="center">0.626</td>
</tr>
<tr class="even">
<td align="center"><strong>CP143</strong></td>
<td align="center">CP143</td>
<td align="center">3-Methylhistidine</td>
<td align="center">0.0002466</td>
<td align="center">0.734</td>
</tr>
<tr class="odd">
<td align="center"><strong>CP154</strong></td>
<td align="center">CP154</td>
<td align="center">Asymmetric dimethylarginine</td>
<td align="center">0.0003642</td>
<td align="center">3.688</td>
</tr>
<tr class="even">
<td align="center"><strong>CP162</strong></td>
<td align="center">CP162</td>
<td align="center">Glycerophosphocholine</td>
<td align="center">0.0003917</td>
<td align="center">0.098</td>
</tr>
<tr class="odd">
<td align="center"><strong>CP176</strong></td>
<td align="center">CP176</td>
<td align="center">Deoxyadenosine monophosphate</td>
<td align="center">0.0007856</td>
<td align="center">2.337</td>
</tr>
</tbody>
</table>
<p>Columns <code>"score"</code> and <code>"score_rt"</code> contain the difference between the query and the annotated target’s <em>m/z</em> (in Da) and retention time (in seconds), respectively.</p>
</div>
<div class="section level3">
<h3 id="annotation-using-reference-mz-and-retention-indices">Annotation using reference <em>m/z</em> and retention indices<a class="anchor" aria-label="anchor" href="#annotation-using-reference-mz-and-retention-indices"></a>
</h3>
<p>Retention time is a valuable orthogonal information for metabolite identification, but chromatographic conditions are far from being standardized. Even when using nominally the same chromatographic system, meaning column and eluents, differences in retention times arise due to dead volumes, gradient delay volumes, etc. In GC-MS retention time indexing has been used to normalize for drifts in retention times by converting them into retention indices. A similar approach has been recently described for LC-MS <span class="citation">(Stoffel et al. 2021)</span> using N-Alkyl-pyridinium sulfonates as retention indexing substances. Their use allows to convert retention times into retention indices and to compare retention information across different LC-MS systems.</p>
<p>We first load data from an untargeted metabolomic experiments. This data has been completely processed. Each feature is identified by a unique name.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MetaboCoreUtils" class="external-link">MetaboCoreUtils</a></span><span class="op">)</span>

<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"txt"</span>, <span class="st">"rti_ms_pos_features.txt"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>
<span class="va">ms1_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fl</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ms1_features</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##            Name       mz    rtime Cel_pure_1.B.1_01_21144</span>
<span class="co">## 1 Cluster_00003 71.01397 1.527515                946.2993</span>
<span class="co">## 2 Cluster_00004 72.33667 1.529377               1402.1213</span>
<span class="co">## 3 Cluster_00006 86.37420 1.946073               7245.5283</span>
<span class="co">## 4 Cluster_00018 66.03701 1.454697               1306.3455</span>
<span class="co">## 5 Cluster_00025 71.03044 1.259239             256197.7500</span>
<span class="co">## 6 Cluster_00030 80.03526 1.259666             242820.3125</span>
<span class="co">##   Cel_pure_1.B.1_01_21149 Cel_pure_1.B.1_01_21154 Cel_pure_1.B.1_01_21159</span>
<span class="co">## 1                 806.088                 796.521                771.9626</span>
<span class="co">## 2                1427.545                1334.492               1400.0985</span>
<span class="co">## 3                8062.006                8196.895               8502.9092</span>
<span class="co">## 4                1389.757                1338.029               1341.1783</span>
<span class="co">## 5              238996.312              212299.125             242366.2188</span>
<span class="co">## 6              209218.312              174476.219             223134.0000</span>
<span class="co">##   Cel_pure_1.B.1_01_21164</span>
<span class="co">## 1                 713.608</span>
<span class="co">## 2                1503.299</span>
<span class="co">## 3                9668.902</span>
<span class="co">## 4                1584.487</span>
<span class="co">## 5              239547.453</span>
<span class="co">## 6              215851.828</span></code></pre>
<p>Likewise we load the information on the N-Alkyl-pyridinium sulfonates. The retention index is defined as the number of carbons in the alkyl chain times 100.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"txt"</span>, <span class="st">"rti_ms_pos_naps.txt"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>
<span class="va">ms1_naps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fl</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ms1_naps</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   rtime rindex</span>
<span class="co">## 1    NA    100</span>
<span class="co">## 2   1.5    200</span>
<span class="co">## 3   1.7    300</span>
<span class="co">## 4   2.6    400</span>
<span class="co">## 5   5.9    500</span>
<span class="co">## 6  10.3    600</span></code></pre>
<p>The relationship between the retention time and retention index can be plotted.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/plot-methods.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ms1_naps</span><span class="op">)</span></code></pre></div>
<p><img src="annotation-use-cases_files/figure-html/unnamed-chunk-22-1.png" width="768"></p>
<p>We can use the N-Alkly-pyridinium sulfonates to convert the retention times of the measured features using the <code>indexRtime</code> function. By default linear interpolation is used for conversion, but other (custom) functions can be defined if required.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ms1_features</span><span class="op">$</span><span class="va">rindex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/indexRtime.html" class="external-link">indexRtime</a></span><span class="op">(</span><span class="va">ms1_features</span><span class="op">$</span><span class="va">rtime</span>, <span class="va">ms1_naps</span><span class="op">)</span></code></pre></div>
<p>This data can then be annotated using reference databases. Two different databases are used. One was obtained on a UHPLC column and one on a HPLC column of the same column chemistry. The untargeted data was obtained from a HPLC column, but using a different LC hardware, resulting in different absolute retention times.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"txt"</span>, <span class="st">"rti_db_hplc.txt"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>
<span class="va">db_hplc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fl</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>,
                      quote <span class="op">=</span> <span class="st">""</span>, comment.char <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"txt"</span>, <span class="st">"rti_db_uhplc.txt"</span>,
                  package <span class="op">=</span> <span class="st">"MetaboAnnotationTutorials"</span><span class="op">)</span>
<span class="va">db_uhplc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fl</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">"\t"</span>,
                      quote <span class="op">=</span> <span class="st">""</span>, comment.char <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>Next we can define the <code>Mass2MzRtParam</code> similar to above. We will use an absolute error of 10 retention index units and use <code>[M+H]+</code>and <code>[M+Na]+</code> adducts.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">match_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">Mass2MzRtParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>,
                              tolerance <span class="op">=</span> <span class="fl">0.005</span>,
                              toleranceRt <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Matching can now be performed. Important is that the column with the retention index needs to be defined using <code>rtColname</code>. Matching is performed against both databases and results are then filtered to only contain features with at least one match.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matches_hplc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span><span class="va">ms1_features</span>,
                        <span class="va">db_hplc</span>,
                        <span class="va">match_param</span>,
                        massColname <span class="op">=</span> <span class="st">"exact.mass"</span>,
                        mzColname <span class="op">=</span> <span class="st">"mz"</span>,
                        rtColname <span class="op">=</span> <span class="st">"rindex"</span><span class="op">)</span>

<span class="va">matches_hplc</span> <span class="op">&lt;-</span> <span class="va">matches_hplc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">whichQuery</a></span><span class="op">(</span><span class="va">matches_hplc</span><span class="op">)</span><span class="op">]</span>

<span class="va">matches_uhplc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span><span class="va">ms1_features</span>,
                         <span class="va">db_uhplc</span>,
                         <span class="va">match_param</span>,
                         massColname <span class="op">=</span> <span class="st">"exact.mass"</span>,
                         mzColname <span class="op">=</span> <span class="st">"mz"</span>,
                         rtColname <span class="op">=</span> <span class="st">"rindex"</span><span class="op">)</span>

<span class="va">matches_uhplc</span> <span class="op">&lt;-</span> <span class="va">matches_uhplc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">whichQuery</a></span><span class="op">(</span><span class="va">matches_uhplc</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>We next build a result table for the successfully annotated chromatographic peaks. First for the results matching with the HPLC database.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matchedData</a></span><span class="op">(</span><span class="va">matches_hplc</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"mz"</span>, <span class="st">"rindex"</span>, <span class="st">"target_name"</span>,
                              <span class="st">"adduct"</span>, <span class="st">"score"</span>, <span class="st">"score_rt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.tables <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Name</th>
<th align="center">mz</th>
<th align="center">rindex</th>
<th align="center">target_name</th>
<th align="center">adduct</th>
<th align="center">score</th>
<th align="center">score_rt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>24</strong></td>
<td align="center">Cluster_00116</td>
<td align="center">132.1</td>
<td align="center">328.8</td>
<td align="center">5-AMINOLEVULINATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.005076</td>
<td align="center">1.226</td>
</tr>
<tr class="even">
<td align="center"><strong>24.1</strong></td>
<td align="center">Cluster_00116</td>
<td align="center">132.1</td>
<td align="center">328.8</td>
<td align="center">N-ACETYLALANINE</td>
<td align="center">[M+H]+</td>
<td align="center">0.005076</td>
<td align="center">1.226</td>
</tr>
<tr class="odd">
<td align="center"><strong>395</strong></td>
<td align="center">Cluster_01443</td>
<td align="center">125.1</td>
<td align="center">418.4</td>
<td align="center">4-METHYLCATECHOL</td>
<td align="center">[M+H]+</td>
<td align="center">0.0002352</td>
<td align="center">8.425</td>
</tr>
<tr class="even">
<td align="center"><strong>434</strong></td>
<td align="center">Cluster_01544</td>
<td align="center">133</td>
<td align="center">392.7</td>
<td align="center">GLUTARATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.000176</td>
<td align="center">0.733</td>
</tr>
<tr class="odd">
<td align="center"><strong>434.1</strong></td>
<td align="center">Cluster_01544</td>
<td align="center">133</td>
<td align="center">392.7</td>
<td align="center">GLUTARATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.000176</td>
<td align="center">2.267</td>
</tr>
<tr class="even">
<td align="center"><strong>469</strong></td>
<td align="center">Cluster_01596</td>
<td align="center">138.1</td>
<td align="center">582.2</td>
<td align="center">SALICYLAMIDE</td>
<td align="center">[M+H]+</td>
<td align="center">0.0001774</td>
<td align="center">1.791</td>
</tr>
</tbody>
</table>
<p>Then for matching with the UPLC database.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/" class="external-link">pander</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/Matched.html" class="external-link">matchedData</a></span><span class="op">(</span><span class="va">matches_uhplc</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"mz"</span>, <span class="st">"rindex"</span>, <span class="st">"target_name"</span>,
                               <span class="st">"adduct"</span>, <span class="st">"score"</span>, <span class="st">"score_rt"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.tables <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center"> </th>
<th align="center">Name</th>
<th align="center">mz</th>
<th align="center">rindex</th>
<th align="center">target_name</th>
<th align="center">adduct</th>
<th align="center">score</th>
<th align="center">score_rt</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>24</strong></td>
<td align="center">Cluster_00116</td>
<td align="center">132.1</td>
<td align="center">328.8</td>
<td align="center">N-ACETYLALANINE</td>
<td align="center">[M+H]+</td>
<td align="center">0.005076</td>
<td align="center">4.774</td>
</tr>
<tr class="even">
<td align="center"><strong>380</strong></td>
<td align="center">Cluster_01397</td>
<td align="center">123</td>
<td align="center">679.6</td>
<td align="center">BENZOATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.0003409</td>
<td align="center">1.38</td>
</tr>
<tr class="odd">
<td align="center"><strong>434</strong></td>
<td align="center">Cluster_01544</td>
<td align="center">133</td>
<td align="center">392.7</td>
<td align="center">GLUTARATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.000176</td>
<td align="center">4.733</td>
</tr>
<tr class="even">
<td align="center"><strong>434.1</strong></td>
<td align="center">Cluster_01544</td>
<td align="center">133</td>
<td align="center">392.7</td>
<td align="center">GLUTARATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.000176</td>
<td align="center">3.733</td>
</tr>
<tr class="odd">
<td align="center"><strong>469</strong></td>
<td align="center">Cluster_01596</td>
<td align="center">138.1</td>
<td align="center">582.2</td>
<td align="center">4-AMINOBENZOATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.0001774</td>
<td align="center">2.791</td>
</tr>
<tr class="even">
<td align="center"><strong>469.1</strong></td>
<td align="center">Cluster_01596</td>
<td align="center">138.1</td>
<td align="center">582.2</td>
<td align="center">ANTHRANILATE</td>
<td align="center">[M+H]+</td>
<td align="center">0.0001774</td>
<td align="center">2.791</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="ms2">
<span class="math inline">\(MS^2\)</span> annotation<a class="anchor" aria-label="anchor" href="#ms2"></a>
</h2>
<p>In addition to <span class="math inline">\(MS^1\)</span> annotation described in the previous section, it is also possible to annotate features (or chromatographic peaks) by comparing experimentally measured <span class="math inline">\(MS^2\)</span> (MS/MS) spectra against reference spectra. Such annotation can be performed using the <code>matchSpectra</code> from the <code>MetaboAnnotation</code> package that takes <code>Spectra</code> objects (with <span class="math inline">\(MS^2\)</span> spectra) as query and target parameters. Such <code>Spectra</code> objects can be either imported from a variety of input formats, including MGF, MSP, mzML, mzXML or netCDF files, extracted from <code>xcms</code> result objects or even retrieved from databases such as <em>MassBank</em> (see also the tutorials from <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link">SpectraTutorials</a> for more examples and use cases).</p>
<p>To illustrate this, we will extract in this section <span class="math inline">\(MS^2\)</span> spectra for the annotated chromatographic peaks from the previous section and compare them against reference <span class="math inline">\(MS^2\)</span> spectra from HMDB. Annotation reliability can be increased if, in addition to <em>m/z</em> and retention time, also the <span class="math inline">\(MS^2\)</span> spectra for a chromatographic peak or a feature matches the reference spectrum from a pure standard.</p>
<p>We first extract all <span class="math inline">\(MS^2\)</span> spectra for the annotated chromatographic peaks using the <code>chromPeakSpectra</code> function from the <code>xcms</code> result object. This will return all <span class="math inline">\(MS^2\)</span> spectra with the precursor <em>m/z</em> and retention time within the <em>m/z</em> ranges and retention time ranges of the detected chromatographic peaks. For an <code>xcms</code> result object containing also correspondence results (i.e. grouped chromatographic peaks across samples, also referred to as <em>features</em>) the <code>featureSpectra</code> function could be used instead.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">std_spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xcms/man/chromPeakSpectra.html" class="external-link">chromPeakSpectra</a></span><span class="op">(</span><span class="va">std_data</span>, return.type <span class="op">=</span> <span class="st">"Spectra"</span>,
                                peaks <span class="op">=</span> <span class="va">pks_match</span><span class="op">$</span><span class="va">peak_id</span><span class="op">)</span>
<span class="va">std_spectra</span></code></pre></div>
<pre><code><span class="co">## MSn data (Spectra) with 11 spectra in a MsBackendMzR backend:</span>
<span class="co">##           msLevel     rtime scanIndex</span>
<span class="co">##         &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="co">## F1.S107         2    35.650       107</span>
<span class="co">## F1.S193         2    66.622       193</span>
<span class="co">## F1.S224         2    78.600       224</span>
<span class="co">## F1.S127         2    38.323       127</span>
<span class="co">## F1.S159         2    50.239       159</span>
<span class="co">## F1.S581         2   184.743       581</span>
<span class="co">## F1.S649         2   197.112       649</span>
<span class="co">## F1.S548         2   175.749       548</span>
<span class="co">## F1.S600         2   188.408       600</span>
<span class="co">## F1.S707         2   209.046       707</span>
<span class="co">## F1.S760         2   221.347       760</span>
<span class="co">##  ... 38 more variables/columns.</span>
<span class="co">## </span>
<span class="co">## file(s):</span>
<span class="co">## HighIS_Mix07_CE20_POS.mzML</span></code></pre>
<p>For some of the chromatographic peaks we have more than one <span class="math inline">\(MS^2\)</span> spectrum, but in total we have <span class="math inline">\(MS^2\)</span> spectra only for 7 chromatographic peaks. Below we count the number of spectra per peak.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">std_spectra</span><span class="op">$</span><span class="va">peak_id</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## CP067 CP074 CP080 CP143 CP154 CP162 CP176 </span>
<span class="co">##     1     2     2     2     1     1     2</span></code></pre>
<p>Before matching the spectra we are <em>cleaning</em> our experimental spectra removing peaks with an intensity lower than 5% of a spectra’s highest peak intensity and removing spectra with less than 3 peaks.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Define a function to remove low intensity peaks</span>
<span class="va">low_int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.05</span>
<span class="op">}</span>
<span class="co">#' Remove peaks with an intensity below 5% of BPI</span>
<span class="va">std_spectra</span> <span class="op">&lt;-</span> <span class="fu">filterIntensity</span><span class="op">(</span><span class="va">std_spectra</span>, intensity <span class="op">=</span> <span class="va">low_int</span><span class="op">)</span>

<span class="co">#' Remove peaks with less than 3 peaks</span>
<span class="va">std_spectra</span> <span class="op">&lt;-</span> <span class="va">std_spectra</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">std_spectra</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span>
<span class="va">std_spectra</span></code></pre></div>
<pre><code><span class="co">## MSn data (Spectra) with 8 spectra in a MsBackendMzR backend:</span>
<span class="co">##           msLevel     rtime scanIndex</span>
<span class="co">##         &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="co">## F1.S107         2    35.650       107</span>
<span class="co">## F1.S127         2    38.323       127</span>
<span class="co">## F1.S159         2    50.239       159</span>
<span class="co">## F1.S581         2   184.743       581</span>
<span class="co">## F1.S649         2   197.112       649</span>
<span class="co">## F1.S548         2   175.749       548</span>
<span class="co">## F1.S600         2   188.408       600</span>
<span class="co">## F1.S707         2   209.046       707</span>
<span class="co">##  ... 38 more variables/columns.</span>
<span class="co">## </span>
<span class="co">## file(s):</span>
<span class="co">## HighIS_Mix07_CE20_POS.mzML</span>
<span class="co">## Lazy evaluation queue: 1 processing step(s)</span>
<span class="co">## Processing:</span>
<span class="co">##  Remove peaks based on their intensities and a user-provided function in spectra of MS level(s) 2. [Wed Jan 26 14:08:01 2022]</span></code></pre>
<p>In addition, we scale the peak intensities within each spectrum to values between 0 and 100. This is mostly for visualization reason, since most spectra similarity scoring algorithms are independent of absolute peak intensities.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Define a function to *scale* the intensities</span>
<span class="va">scale_int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">maxint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>, <span class="st">"intensity"</span><span class="op">]</span> <span class="op">/</span> <span class="va">maxint</span>
    <span class="va">x</span>
<span class="op">}</span>
<span class="co">#' *Apply* the function to the data</span>
<span class="va">std_spectra</span> <span class="op">&lt;-</span> <span class="fu">addProcessing</span><span class="op">(</span><span class="va">std_spectra</span>, <span class="va">scale_int</span><span class="op">)</span></code></pre></div>
<p>Below we match now these <em>cleaned</em> spectra against the reference spectra from HMDB. We configure the matching using the <code>CompareSpectraParam</code> allowing <em>m/z</em> differences of 50ppm between peaks from a query and a target spectrum. Since HMDB does not provide precursor <em>m/z</em> we in addition have to disable the additional matching filter (i.e. set <code>requirePrecursor = FALSE</code>), which has however a negative impact on the performance of the comparisons. By default, spectra similarities (calculated with the normalized dot product) higher than 0.7 will be considered matching.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spectra_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchSpectra.html" class="external-link">matchSpectra</a></span><span class="op">(</span>
    <span class="va">std_spectra</span>, <span class="fu">Spectra</span><span class="op">(</span><span class="va">cdb</span><span class="op">)</span>,
    param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/CompareSpectraParam.html" class="external-link">CompareSpectraParam</a></span><span class="op">(</span>ppm <span class="op">=</span> <span class="fl">50</span>, requirePrecursor <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">spectra_match</span></code></pre></div>
<pre><code><span class="co">## Object of class MatchedSpectra </span>
<span class="co">## Total number of matches: 27 </span>
<span class="co">## Number of query objects: 8 (4 matched)</span>
<span class="co">## Number of target objects: 64920 (27 matched)</span></code></pre>
<p>Thus, in total 4 of the query spectra were matched with 27. Below we create a result table for this matching.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">spectraData</span><span class="op">(</span><span class="va">spectra_match</span>,
                   <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peak_id"</span>, <span class="st">"target_compound_id"</span>, <span class="st">"score"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cmp_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">target_compound_id</span><span class="op">)</span>
<span class="va">cmp_id</span> <span class="op">&lt;-</span> <span class="va">cmp_id</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cmp_id</span><span class="op">)</span><span class="op">]</span>
<span class="va">cmps</span> <span class="op">&lt;-</span> <span class="fu">compounds</span><span class="op">(</span><span class="va">cdb</span>, filter <span class="op">=</span> <span class="op">~</span> <span class="va">compound_id</span> <span class="op">==</span> <span class="va">cmp_id</span>, <span class="st">"name"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cmps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cmps</span><span class="op">$</span><span class="va">compound_id</span>

<span class="va">res</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">cmps</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">target_compound_id</span>, <span class="st">"name"</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/pkg/pander/man/pandoc.table.return.html" class="external-link">pandoc.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>,
    style <span class="op">=</span> <span class="st">"rmarkdown"</span>, split.tables <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">peak_id</th>
<th align="center">target_compound_id</th>
<th align="center">score</th>
<th align="center">name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">CP067</td>
<td align="center">HMDB0001847</td>
<td align="center">0.7258</td>
<td align="center">Caffeine</td>
</tr>
<tr class="even">
<td align="center">CP067</td>
<td align="center">HMDB0001847</td>
<td align="center">0.705</td>
<td align="center">Caffeine</td>
</tr>
<tr class="odd">
<td align="center">CP067</td>
<td align="center">HMDB0001847</td>
<td align="center">0.7016</td>
<td align="center">Caffeine</td>
</tr>
<tr class="even">
<td align="center">CP067</td>
<td align="center">HMDB0001847</td>
<td align="center">0.7046</td>
<td align="center">Caffeine</td>
</tr>
<tr class="odd">
<td align="center">CP080</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">CP080</td>
<td align="center">HMDB0253992</td>
<td align="center">0.7589</td>
<td align="center">Laurocapram</td>
</tr>
<tr class="odd">
<td align="center">CP080</td>
<td align="center">HMDB0253992</td>
<td align="center">0.7789</td>
<td align="center">Laurocapram</td>
</tr>
<tr class="even">
<td align="center">CP143</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">CP143</td>
<td align="center">HMDB0000479</td>
<td align="center">0.8739</td>
<td align="center">3-Methylhistidine</td>
</tr>
<tr class="even">
<td align="center">CP143</td>
<td align="center">HMDB0000479</td>
<td align="center">0.8739</td>
<td align="center">3-Methylhistidine</td>
</tr>
<tr class="odd">
<td align="center">CP154</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">CP162</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7165</td>
<td align="center">Adenine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7094</td>
<td align="center">Adenine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7092</td>
<td align="center">Adenine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7133</td>
<td align="center">Adenine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7165</td>
<td align="center">Adenine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7123</td>
<td align="center">Adenine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7165</td>
<td align="center">Adenine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7165</td>
<td align="center">Adenine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000034</td>
<td align="center">0.7139</td>
<td align="center">Adenine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000050</td>
<td align="center">0.7067</td>
<td align="center">Adenosine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000050</td>
<td align="center">0.7165</td>
<td align="center">Adenosine</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000101</td>
<td align="center">0.7165</td>
<td align="center">Deoxyadenosine</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.9523</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.8143</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.7407</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.9136</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.9523</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="even">
<td align="center">CP176</td>
<td align="center">HMDB0000905</td>
<td align="center">0.9524</td>
<td align="center">Deoxyadenosine monophosphate</td>
</tr>
<tr class="odd">
<td align="center">CP176</td>
<td align="center">HMDB0001983</td>
<td align="center">0.7086</td>
<td align="center">5’-Deoxyadenosine</td>
</tr>
</tbody>
</table>
<p>Matching results can also be very easily visualized with the <code>plotSpectraMirror</code> function. Below we show the results for the first peak (Caffeine). The upper spectrum represents the query, the lower the target (reference) spectrum.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotSpectraMirror</span><span class="op">(</span><span class="va">spectra_match</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="annotation-use-cases_files/figure-html/unnamed-chunk-35-1.png" width="768"></p>
<p>The results seem to be reasonable. For the second peak (third spectrum) the match was based however on a single peak.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotSpectraMirror</span><span class="op">(</span><span class="va">spectra_match</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="annotation-use-cases_files/figure-html/unnamed-chunk-36-1.png" width="768"></p>
<p>Note that we could now also add some of the (cleaned and annotated) <span class="math inline">\(MS^2\)</span> spectra from the present test set, to the <code>IonDb</code> using the <code>insertSpectra</code> function. This enables generation of lab-internal reference databases including also MS/MS spectra.</p>
</div>
<div class="section level2">
<h2 id="working-with-data-from-other-tools">Working with data from other tools<a class="anchor" aria-label="anchor" href="#working-with-data-from-other-tools"></a>
</h2>
<p><span class="math inline">\(MS^1\)</span>-based annotations can be performed on any <code>data.frame</code> or similar that provides <span class="math inline">\(m/z\)</span> and/or retention time values. For <span class="math inline">\(MS^2\)</span>-based annotations a <code>Spectra</code> object would be needed, and that can be imported from a variety of formats. In this section we show how pre-processing results from an external tool (in this case <a href="https://mzmine.github.io/" class="external-link">MZmine</a>) can be imported and used as input for <code>MetaboAnnotation</code>.</p>
<p>The test data we are using is one of the example data sets for GNPS Feature-Based Molecular Networking <span class="citation">(Nothias et al. 2020)</span>. A description on how this data was generated is provided in the <a href="https://ccms-ucsd.github.io/GNPSDocumentation/featurebasedmolecularnetworking-with-mzmine2/" class="external-link">GNPS Feature-Based Molecular Networking documentation</a>. The data set consists of feature abundances (along with retention time and m/z values) and <span class="math inline">\(MS^2\)</span> spectra for these features. These example files are distributed through the github repository of the GNPS documentation <a href="https://github.com/CCMS-UCSD/GNPSDocumentation.git" class="external-link">https://github.com/CCMS-UCSD/GNPSDocumentation.git</a>.</p>
<p>Below we first download the feature table (in csv format) from the above mentioned repository to a temporary file.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f_file</span> <span class="op">&lt;-</span> <span class="st">"MZmine-GNPS_AG_test_featuretable.csv"</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/CCMS-UCSD/GNPSDocumentation"</span>,
              <span class="st">"/master/docs/tutorials/AG_tutorial_files/"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html" class="external-link">curl_download</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">f_file</span><span class="op">)</span>,
              destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_file</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We next load this file into R using the base <code>read.csv</code> function.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f_file</span><span class="op">)</span>, check.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We can now use this file as an input for <span class="math inline">\(MS^1\)</span>-based annotation, as shown in section <a href="#ms1mz">Annotation using <em>m/z</em> values</a> above, and match the m/z values of the features against HMDB assuming <code>[M+H]+</code> and <code>[M+Na]+</code> adducts. With parameter <code>mzColname</code> we define the column in the input file containing the m/z values. For MZmine this is column <code>"row m/z"</code>.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">Mass2MzParam</a></span><span class="op">(</span>adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[M+H]+"</span>, <span class="st">"[M+Na]+"</span><span class="op">)</span>, ppm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="va">f_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MetaboAnnotation/man/matchMz.html" class="external-link">matchMz</a></span><span class="op">(</span>
    <span class="va">ftable</span>,
    <span class="fu">compounds</span><span class="op">(</span><span class="va">cdb</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"compound_id"</span>, <span class="st">"exactmass"</span>, <span class="st">"formula"</span>, <span class="st">"name"</span><span class="op">)</span><span class="op">)</span>,
    param <span class="op">=</span> <span class="va">param</span>,
    mzColname <span class="op">=</span> <span class="st">"row m/z"</span><span class="op">)</span>
<span class="va">f_match</span></code></pre></div>
<pre><code><span class="co">## Object of class Matched </span>
<span class="co">## Total number of matches: 31333 </span>
<span class="co">## Number of query objects: 3443 (2251 matched)</span>
<span class="co">## Number of target objects: 217776 (13194 matched)</span></code></pre>
<p>For 2251 of the in total 3443 features a compound matching the feature’s m/z was found.</p>
<p><span class="math inline">\(MS^2\)</span> spectra can be exported from MZmine in mgf file format. Below we download the MGF file with all <span class="math inline">\(MS^2\)</span> spectra for the features from the example above to a temporary folder.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s_file</span> <span class="op">&lt;-</span> <span class="st">"MZmine-GNPS_AG_test_GNPS.mgf"</span>
<span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl_download.html" class="external-link">curl_download</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">s_file</span><span class="op">)</span>,
              destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">s_file</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Files in MGF format can be imported with the <em><a href="https://bioconductor.org/packages/3.14/MsBackendMgf" class="external-link">MsBackendMgf</a></em> package. Below we use this package to create a <code>Spectra</code> object with all spectra from the example file.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMgf" class="external-link">MsBackendMgf</a></span><span class="op">)</span>
<span class="va">sps_mgf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">s_file</span><span class="op">)</span>,
                   source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsBackendMgf/man/MsBackendMgf.html" class="external-link">MsBackendMgf</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>By default all data fields from the original MGF file are imported. Thus, the <code>Spectra</code> object contains also a variable called <code>FEATURE_ID</code> with the identifiers for the features the spectra are associated with.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sps_mgf</span><span class="op">$</span><span class="va">FEATURE_ID</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "1" "2" "3" "4" "6" "7"</span></code></pre>
<p>This <code>Spectra</code> object could then simply be used as in input parameter to the <code>matchSpectra</code> function as shown in the <a href="#ms2"><span class="math inline">\(MS^2\)</span> annotation section</a> above to e.g. identify matches with reference spectra from HMDB.</p>
</div>
<div class="section level2">
<h2 id="package-repositories-and-additional-tutorials">Package repositories and additional tutorials<a class="anchor" aria-label="anchor" href="#package-repositories-and-additional-tutorials"></a>
</h2>
<ul>
<li>Tutorial with additional examples and explanations for <span class="math inline">\(MS^2\)</span>-based annotations: <a href="https://jorainer.github.io/SpectraTutorials/" class="external-link uri">https://jorainer.github.io/SpectraTutorials/</a>
</li>
<li>Repository of the <code>MsCoreUtils</code> package: <a href="https://rformassspectrometry.github.io/MsCoreUtils/" class="external-link uri">https://rformassspectrometry.github.io/MsCoreUtils/</a>
</li>
<li>Repository of the <code>MetaboCoreUtils</code> package: <a href="https://rformassspectrometry.github.io/MetaboCoreUtils/" class="external-link uri">https://rformassspectrometry.github.io/MetaboCoreUtils/</a>
</li>
<li>Repository of the <code>Spectra</code> package: <a href="https://rformassspectrometry.github.io/Spectra/" class="external-link uri">https://rformassspectrometry.github.io/Spectra/</a>
</li>
<li>Repository of the <code>MetaboAnnotation</code> package: <a href="https://rformassspectrometry.github.io/MetaboAnnotation/" class="external-link uri">https://rformassspectrometry.github.io/MetaboAnnotation/</a>
</li>
<li>Repository of the <code>CompoundDb</code> package: <a href="https://rformassspectrometry.github.io/CompoundDb/" class="external-link uri">https://rformassspectrometry.github.io/CompoundDb/</a>
</li>
</ul>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>The R version and versions of used packages are listed below.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">## Running under: Ubuntu 20.04.3 LTS</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             </span>
<span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">## [8] base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">##  [1] MsBackendMgf_1.2.0      Spectra_1.5.7           MetaboCoreUtils_1.2.0  </span>
<span class="co">##  [4] pander_0.6.4            MetaboAnnotation_0.99.3 CompoundDb_0.99.4      </span>
<span class="co">##  [7] AnnotationFilter_1.18.0 curl_4.3.2              xcms_3.16.1            </span>
<span class="co">## [10] MSnbase_2.20.4          ProtGenerics_1.26.0     S4Vectors_0.32.3       </span>
<span class="co">## [13] mzR_2.28.0              Rcpp_1.0.8              Biobase_2.54.0         </span>
<span class="co">## [16] BiocGenerics_0.40.0     BiocParallel_1.28.3     knitr_1.37             </span>
<span class="co">## [19] BiocStyle_2.22.0       </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##   [1] colorspace_2.0-2            rjson_0.2.21               </span>
<span class="co">##   [3] ellipsis_0.3.2              rprojroot_2.0.2            </span>
<span class="co">##   [5] XVector_0.34.0              GenomicRanges_1.46.1       </span>
<span class="co">##   [7] base64enc_0.1-3             fs_1.5.2                   </span>
<span class="co">##   [9] clue_0.3-60                 affyio_1.64.0              </span>
<span class="co">##  [11] DT_0.20                     bit64_4.0.5                </span>
<span class="co">##  [13] fansi_1.0.2                 xml2_1.3.3                 </span>
<span class="co">##  [15] codetools_0.2-18            ncdf4_1.19                 </span>
<span class="co">##  [17] doParallel_1.0.16           cachem_1.0.6               </span>
<span class="co">##  [19] impute_1.68.0               robustbase_0.93-9          </span>
<span class="co">##  [21] jsonlite_1.7.3              dbplyr_2.1.1               </span>
<span class="co">##  [23] cluster_2.1.2               vsn_3.62.0                 </span>
<span class="co">##  [25] png_0.1-7                   BiocManager_1.30.16        </span>
<span class="co">##  [27] compiler_4.1.2              assertthat_0.2.1           </span>
<span class="co">##  [29] Matrix_1.4-0                fastmap_1.1.0              </span>
<span class="co">##  [31] lazyeval_0.2.2              limma_3.50.0               </span>
<span class="co">##  [33] htmltools_0.5.2             tools_4.1.2                </span>
<span class="co">##  [35] gtable_0.3.0                glue_1.6.0                 </span>
<span class="co">##  [37] GenomeInfoDbData_1.2.7      affy_1.72.0                </span>
<span class="co">##  [39] RANN_2.6.1                  dplyr_1.0.7                </span>
<span class="co">##  [41] rsvg_2.1.2                  MALDIquant_1.21            </span>
<span class="co">##  [43] jquerylib_0.1.4             pkgdown_2.0.2.9000         </span>
<span class="co">##  [45] vctrs_0.3.8                 preprocessCore_1.56.0      </span>
<span class="co">##  [47] iterators_1.0.13            xfun_0.29                  </span>
<span class="co">##  [49] stringr_1.4.0               lifecycle_1.0.1            </span>
<span class="co">##  [51] XML_3.99-0.8                DEoptimR_1.0-10            </span>
<span class="co">##  [53] zlibbioc_1.40.0             MASS_7.3-55                </span>
<span class="co">##  [55] scales_1.1.1                ragg_1.2.1                 </span>
<span class="co">##  [57] pcaMethods_1.86.0           MatrixGenerics_1.6.0       </span>
<span class="co">##  [59] parallel_4.1.2              SummarizedExperiment_1.24.0</span>
<span class="co">##  [61] MassSpecWavelet_1.60.0      RColorBrewer_1.1-2         </span>
<span class="co">##  [63] yaml_2.2.1                  memoise_2.0.1              </span>
<span class="co">##  [65] gridExtra_2.3               ggplot2_3.3.5              </span>
<span class="co">##  [67] MsFeatures_1.2.0            sass_0.4.0                 </span>
<span class="co">##  [69] stringi_1.7.6               RSQLite_2.2.9              </span>
<span class="co">##  [71] highr_0.9                   desc_1.4.0                 </span>
<span class="co">##  [73] foreach_1.5.1               GenomeInfoDb_1.30.0        </span>
<span class="co">##  [75] rlang_0.4.12                pkgconfig_2.0.3            </span>
<span class="co">##  [77] systemfonts_1.0.3           matrixStats_0.61.0         </span>
<span class="co">##  [79] bitops_1.0-7                mzID_1.32.0                </span>
<span class="co">##  [81] evaluate_0.14               lattice_0.20-45            </span>
<span class="co">##  [83] purrr_0.3.4                 ChemmineR_3.46.0           </span>
<span class="co">##  [85] htmlwidgets_1.5.4           bit_4.0.4                  </span>
<span class="co">##  [87] tidyselect_1.1.1            plyr_1.8.6                 </span>
<span class="co">##  [89] magrittr_2.0.1              R6_2.5.1                   </span>
<span class="co">##  [91] IRanges_2.28.0              generics_0.1.1             </span>
<span class="co">##  [93] DelayedArray_0.20.0         DBI_1.1.2                  </span>
<span class="co">##  [95] pillar_1.6.4                MsCoreUtils_1.6.0          </span>
<span class="co">##  [97] RCurl_1.98-1.5              tibble_3.1.6               </span>
<span class="co">##  [99] crayon_1.4.2                utf8_1.2.2                 </span>
<span class="co">## [101] rmarkdown_2.11              grid_4.1.2                 </span>
<span class="co">## [103] blob_1.2.2                  digest_0.6.29              </span>
<span class="co">## [105] textshaping_0.3.6           munsell_0.5.0              </span>
<span class="co">## [107] bslib_0.3.1</span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-nothias_feature-based_2020" class="csl-entry">
Nothias, Louis-Félix, Daniel Petras, Robin Schmid, Kai Dührkop, Johannes Rainer, Abinesh Sarvepalli, Ivan Protsyuk, et al. 2020. <span>“Feature-Based Molecular Networking in the <span>GNPS</span> Analysis Environment.”</span> <em>Nature Methods</em> 17 (9): 905–8. <a href="https://doi.org/10.1038/s41592-020-0933-6" class="external-link">https://doi.org/10.1038/s41592-020-0933-6</a>.
</div>
<div id="ref-stoffelNAlkylpyridiniumSulfonatesRetention2021" class="csl-entry">
Stoffel, Rainer, Michael A. Quilliam, Normand Hardt, Anders Fridstrom, and Michael Witting. 2021. <span>“N-<span>Alkylpyridinium</span> Sulfonates for Retention Time Indexing in Reversed-Phase-Liquid Chromatography-Mass Spectrometry–Based Metabolomics.”</span> <em>Analytical and Bioanalytical Chemistry</em>, December. <a href="https://doi.org/10.1007/s00216-021-03828-0" class="external-link">https://doi.org/10.1007/s00216-021-03828-0</a>.
</div>
<div id="ref-wishartHMDBHumanMetabolome2018" class="csl-entry">
Wishart, David S., Yannick Djoumbou Feunang, Ana Marcu, An Chi Guo, Kevin Liang, Rosa Vázquez-Fresno, Tanvir Sajed, et al. 2018. <span>“<span>HMDB</span> 4.0: The Human Metabolome Database for 2018.”</span> <em>Nucleic Acids Research</em> 46 (D1): D608–17. <a href="https://doi.org/10.1093/nar/gkx1089" class="external-link">https://doi.org/10.1093/nar/gkx1089</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Johannes Rainer, Michael Witting, Laurent Gatto, Sebastian Gibb.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
